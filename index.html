<script>
  const users = {};
  let currentUser = null;

  function register() {
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value;

    if (user.length < 3 || user.length > 30) {
      alert("Username must be between 3 and 30 characters.");
      return;
    }

    if (pass.length < 8) {
      alert("Password must be at least 8 characters.");
      return;
    }

    if (users[user]) {
      alert("Username already exists.");
    } else {
      users[user] = pass;
      alert("Registered successfully.");
    }
  }

  function login() {
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value;

    if (!users[user]) {
      alert("Username not found.");
      return;
    }

    if (users[user] !== pass) {
      alert("Incorrect password.");
      return;
    }

    currentUser = user;
    document.getElementById('auth').style.display = 'none';
    document.getElementById('chat').style.display = 'block';
    document.getElementById('userDisplay').textContent = user;
  }

  function logout() {
    currentUser = null;
    document.getElementById('chat').style.display = 'none';
    document.getElementById('auth').style.display = 'block';
    document.getElementById('messages').innerHTML = '';
  }

  function sendMessage() {
    const msg = document.getElementById('messageInput').value;
    if (msg.trim() === '') return;
    const messages = document.getElementById('messages');
    const newMsg = document.createElement('div');
    newMsg.className = 'msg';
    newMsg.textContent = `${currentUser}: ${msg}`;
    messages.appendChild(newMsg);
    document.getElementById('messageInput').value = '';
    messages.scrollTop = messages.scrollHeight;
  }

  document.getElementById('auth').style.display = 'block';
</script>
